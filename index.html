<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt; &lt;html lang="ja"&gt; &lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;meta name="viewport"content="width=device-width, initial-scale=1.0"&gt; &lt;title&gt;Madamashi&lt;/title&gt; &lt;style&gt; /* --- „Çπ„Çø„Ç§„É´ÂÆöÁæ©ÔºàÂ§âÊõ¥„Å™„ÅóÔºâ --- */ :root { --bg-color: #ffffff; --border-color: #eff3f4; --text-main: #0f1419; --text-secondary: #536471; --accent-color: #1d9bf0; --hover-bg: #f7f9f9; --media-radius: 16px; --homework-red: #d93025; } body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text-main); margin: 0; display: flex; justify-content: center; } .container { width: 100%; max-width: 600px; border-left: 1px solid var(--border-color); border-right: 1px solid var(--border-color); min-height: 100vh;padding-bottom: 50px; } .header { position: sticky; top: 0; background-color: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); z-index: 100; border-bottom: 1px solid var(--border-color); } .search-container { padding: 12px 16px;background-color: var(--bg-color); display: flex; flex-direction: column; gap: 10px; } .search-input { width: 100%;padding: 10px 16px; background-color: #eff3f4; border: 1px solid transparent; border-radius: 9999px; font-size: 15px;outline: none; box-sizing: border-box; transition: 0.2s; } .search-input:focus { background-color: var(--bg-color);border-color: var(--accent-color); box-shadow: 0 0 0 1px var(--accent-color); } .filter-row { display: flex; justify-content: flex-end; } .filter-btn { background-color: white; color: var(--text-secondary); border: 1px solid var(--border-color); padding: 6px 16px; border-radius: 9999px; font-size: 13px; font-weight: bold; cursor: pointer; transition: 0.2s; }.filter-btn.active { background-color: #fce8e6; color: var(--homework-red); border-color: #fad2cf; } .auth-container {display: flex; align-items: center; justify-content: center; min-height: 80vh; text-align: center; } button.login-btn {background-color: var(--accent-color); color: white; border: none; padding: 15px 30px; border-radius: 9999px; font-weight: bold; cursor: pointer; font-size: 18px; transition: 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.1); } button.login-btn:hover { background-color: #1a8cd8; transform: translateY(-1px); } .loading { text-align: center; padding: 40px;color: var(--text-secondary); display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 14px; } .spinner { border: 3px solid var(--border-color); border-top: 3px solid var(--accent-color); border-radius: 50%;width: 26px; height: 26px; animation: spin 0.8s linear infinite; margin-bottom: 12px; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .tweet { padding: 12px 16px; border-bottom: 1pxsolid var(--border-color); display: flex; gap: 10px; transition: background-color 0.2s; cursor: pointer; } .tweet:hover {background-color: var(--hover-bg); } .avatar-container { flex-shrink: 0; } .avatar-img { width: 40px; height: 40px;border-radius: 50%; object-fit: cover; background-color: #ddd; border: 1px solid rgba(0,0,0,0.04); } .avatar-fallback {width: 32px; height: 32px; border-radius: 50%; background-color: #8899a6; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; } .content { flex: 1; min-width: 0; } .user-info {display: block; margin-bottom: 4px; } .user-header-row { display: flex; align-items: center; gap: 4px; font-size: 15px; }.user-name { font-weight: 700; color: var(--text-main); } .user-screenname { display: block; color: var(--text-secondary); font-weight: 400; font-size: 14px; text-decoration: none; white-space: normal; word-break: break-all;margin-top: 2px; } .user-screenname:hover { text-decoration: underline; color: var(--accent-color); } .tweet-time {color: var(--text-secondary); font-size: 14px; } .type-badge { font-size: 11px; padding: 2px 6px; border-radius: 4px;margin-left: auto; font-weight: bold; } .badge-homework-not-submitted { background-color: #fce8e6; color: var(--homework-red); border: 1px solid #fad2cf; } .badge-homework-submitted { background-color: #e6f4ea; color: #1e8e3e; border: 1px solid #ceead6; } .tweet-text { font-size: 15px; line-height: 22px; white-space: pre-wrap; word-break: break-word; color: var(--text-main); } .more-link { color: var(--accent-color); text-decoration: none; cursor: pointer; font-weight: 500; } .media-container { margin-top: 12px; border-radius: 12px; overflow: hidden; border: 1pxsolid var(--border-color); background-color: #f8f9fa; max-width: 300px; display: flex; justify-content: center; } .tweet-media-img { width: 100%; height: auto; cursor: pointer; display: block; object-fit: contain; } .attachments-list { margin-top: 12px; display: flex; flex-direction: column; gap: 8px; } .attachment-link { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: var(--text-main); transition: background-color 0.2s; font-size: 14px; } .attachment-link:hover { background-color: #e9ecef; } .attachment-icon { font-size: 20px; } .attachment-title { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 500; } .due-container { margin-top: 8px; font-size: 13px; font-weight: 500; } .due-text-normal { color: var(--text-secondary); } .due-text-warning { color: var(--homework-red); font-weight: bold; } .due-submitted { color: #1e8e3e; font-weight: bold; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div class="container"&gt; &lt;divclass="header"&gt; &lt;div id="search_box" class="search-container" style="display: none;"&gt; &lt;input type="text"id="keyword_input" class="search-input" placeholder="ÊäïÁ®ø„ÇíÊ§úÁ¥¢" oninput="handleSearch()"&gt; &lt;div class="filter-row"&gt; &lt;button id="homework_filter_btn" class="filter-btn" onclick="toggleHomeworkFilter()"&gt;Ë™≤È°å„ÅÆ„ÅøË°®Á§∫&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id="auth_view" class="auth-container"&gt; &lt;button class="login-btn"onclick="handleAuthClick()"&gt;Google„Åß„É≠„Ç∞„Ç§„É≥&lt;/button&gt; &lt;/div&gt; &lt;div id="timeline" style="display: none;"&gt;&lt;/div&gt;&lt;/div&gt; &lt;script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"&gt;&lt;/script&gt; &lt;script&gt; // --- Ë®≠ÂÆö --- const CLIENT_ID = '509904198894-j2cmhttdj3ks7nvdnupasjliov7aj8a7.apps.googleusercontent.com'; const SCOPES = ['https://www.googleapis.com/auth/classroom.courses.readonly','https://www.googleapis.com/auth/classroom.announcements.readonly','https://www.googleapis.com/auth/classroom.rosters.readonly','https://www.googleapis.com/auth/classroom.coursework.me.readonly','https://www.googleapis.com/auth/classroom.profile.photos','https://www.googleapis.com/auth/drive.metadata.readonly', 'https://www.googleapis.com/auth/drive.readonly' ].join(' ');let tokenClient; let accessToken = null; let allPosts = []; let globalUserMap = {}; let isHomeworkOnly = false; letgisInited = false; // Vercel‰∏ä„ÅÆ„Çµ„Éº„Éê„Éº„É¨„ÇπÈñ¢Êï∞„Å∏„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ„ÇãÂÖ±ÈÄöÈñ¢Êï∞ async functionfetchFromProxy(endpoint, params = {}) { const searchParams = new URLSearchParams({ endpoint, ...params }); constresponse = await fetch(`/api/classroom?${searchParams.toString()}`, { headers: { 'Authorization': `Bearer ${accessToken}` } }); if (!response.ok) throw new Error('API request failed'); return await response.json(); } functiongisLoaded() { tokenClient = google.accounts.oauth2.initTokenClient({ client_id: CLIENT_ID, scope: SCOPES,callback: '', }); gisInited = true; } function handleAuthClick() { tokenClient.callback = async (resp) =&gt; { if (resp.error !== undefined) throw (resp); accessToken = resp.access_token; // „Ç¢„ÇØ„Çª„Çπ„Éà„Éº„ÇØ„É≥„ÇíÂèñÂæódocument.getElementById('auth_view').style.display = 'none'; document.getElementById('timeline').style.display = 'block'; document.getElementById('search_box').style.display = 'flex'; await loadTimeline();setInterval(updateCountdowns, 1000); }; tokenClient.requestAccessToken({ prompt: '' }); } functiontoggleHomeworkFilter() { isHomeworkOnly = !isHomeworkOnly; const btn = document.getElementById('homework_filter_btn'); btn.classList.toggle('active', isHomeworkOnly); handleSearch(); }let searchTimer; function handleSearch() { clearTimeout(searchTimer); searchTimer = setTimeout(() =&gt; { constkeyword = document.getElementById('keyword_input').value.toLowerCase(); const filteredPosts = allPosts.filter(post=&gt; { if (isHomeworkOnly &amp;&amp; post.type !== 'Ë™≤È°å') return false; const user = globalUserMap[post.creatorUserId];const authorName = (user?.name?.fullName || '').toLowerCase(); const text = (post.text || '').toLowerCase(); constcourseName = (post.courseName || '').toLowerCase(); return text.includes(keyword) || authorName.includes(keyword) || courseName.includes(keyword); }); renderPosts(filteredPosts, globalUserMap); }, 300); } async functionloadTimeline() { const timelineDiv = document.getElementById('timeline'); timelineDiv.innerHTML = `&lt;div class="loading"&gt;&lt;div class="spinner"&gt;&lt;/div&gt;ÊäïÁ®ø„ÇíÂèñÂæó‰∏≠...&lt;/div&gt;`; try { // „Ç≥„Éº„Çπ‰∏ÄË¶ß„ÇíÂèñÂæó const coursesData = await fetchFromProxy('courses', { courseStates: 'ACTIVE', pageSize: 30 }); const courses = coursesData.courses || [];const promises = courses.map(async (course) =&gt; { try { // „ÅäÁü•„Çâ„Åõ„Å®Ë™≤È°å„ÇíÂèñÂæó const [aRes, wRes] = awaitPromise.all([ fetchFromProxy(`courses/${course.id}/announcements`, { pageSize: 20 }), fetchFromProxy(`courses/${course.id}/courseWork`, { pageSize: 20 }) ]); const ann = (aRes.announcements || []).map(p =&gt; ({ ...p, courseName: course.name, courseUrl: course.alternateLink, type: '„ÅäÁü•„Çâ„Åõ', materials: p.materials || [] })); const wrkPromises = (wRes.courseWork || []).map(async (p) =&gt; { let status = 'NOT_SUBMITTED';try { const subRes = await fetchFromProxy(`courses/${course.id}/courseWork/${p.id}/studentSubmissions`, { userId: 'me' }); const submission = subRes.studentSubmissions?.[0]; status = (submission?.state === 'TURNED_IN' || submission?.state === 'RETURNED') ? 'SUBMITTED' : 'NOT_SUBMITTED'; } catch (e) { } let dueDate = null; if(p.dueDate) { dueDate = new Date(p.dueDate.year, p.dueDate.month - 1, p.dueDate.day); if (p.dueTime) dueDate.setHours(p.dueTime.hours || 0, p.dueTime.minutes || 0, 0); else dueDate.setHours(23, 59, 59); } return { ...p, text: p.description || p.title, courseName: course.name, courseUrl: course.alternateLink, type: 'Ë™≤È°å', materials: p.materials || [], submissionStatus: status, dueDate: dueDate }; }); const wrk = await Promise.all(wrkPromises); returnann.concat(wrk); } catch (e) { return []; } }); const results = await Promise.all(promises); allPosts = results.flat(); allPosts.sort((a, b) =&gt; new Date(b.creationTime) - new Date(a.creationTime)); const userIds = [...new Set(allPosts.map(p =&gt; p.creatorUserId))]; globalUserMap = await fetchUserProfiles(userIds); renderPosts(allPosts, globalUserMap); } catch (err) { console.error(err); timelineDiv.innerHTML = `&lt;div class="loading" style="color:red"&gt;Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü&lt;/div&gt;`; } } async function fetchUserProfiles(userIds) { const userMap = {}; awaitPromise.all(userIds.map(async (id) =&gt; { try { const res = await fetchFromProxy(`userProfiles/${id}`); userMap[id] = res; } catch (e) { userMap[id] = { name: { fullName: 'User' }, photoUrl: null }; } })); return userMap; } functionrenderPosts(posts, userMap) { const timelineDiv = document.getElementById('timeline'); timelineDiv.innerHTML = ''; posts.forEach((post, i) =&gt; { const user = userMap[post.creatorUserId]; const authorName = user?.name?.fullName || 'ÂÖàÁîü'; let photoUrl = user?.photoUrl ? (user.photoUrl.startsWith('http') ? user.photoUrl : 'https:' + user.photoUrl).replace('/s50/', '/s100/') : null; const avatarHtml = photoUrl ? `&lt;img src="${photoUrl}" class="avatar-img"&gt;` : `&lt;div class="avatar-fallback"&gt;${authorName[0]}&lt;/div&gt;`; const textHtml = formatTweetText(post, i); constattachmentsHtml = renderAttachments(post.materials); let badgeHtml = ''; if (post.type === 'Ë™≤È°å') { const isSubmitted = post.submissionStatus === 'SUBMITTED'; const badgeText = isSubmitted ? 'ÊèêÂá∫Ê∏à' : 'Êú™ÊèêÂá∫'; const badgeClass = isSubmitted ? 'badge-homework-submitted' : 'badge-homework-not-submitted'; badgeHtml = `&lt;span class="type-badge ${badgeClass}"&gt;${badgeText}&lt;/span&gt;`; } let dueHtml = ''; if (post.type === 'Ë™≤È°å' &amp;&amp; post.dueDate) { dueHtml = `&lt;div class="due-container" id="due-${i}" data-post-index="${allPosts.indexOf(post)}"&gt;&lt;/div&gt;`; } else if (post.type === 'Ë™≤È°å' &amp;&amp; !post.dueDate) { dueHtml = `&lt;div class="due-container due-text-normal"&gt;ÊúüÈôê„Å™„Åó&lt;/div&gt;`; } consthtml = ` &lt;div class="tweet" onclick="window.open('${post.alternateLink}?authuser=0', '_blank')"&gt; &lt;div class="avatar-container"&gt;${avatarHtml}&lt;/div&gt; &lt;div class="content"&gt; &lt;div class="user-info"&gt; &lt;div class="user-header-row"&gt; &lt;span class="user-name"&gt;${escapeHtml(authorName)}&lt;/span&gt; &lt;span class="tweet-time"&gt;¬∑ ${formatDate(newDate(post.creationTime))}&lt;/span&gt; ${badgeHtml} &lt;/div&gt; &lt;a href="${post.courseUrl}?authuser=0" target="_blank" class="user-screenname" onclick="event.stopPropagation()"&gt; @${escapeHtml(post.courseName)} &lt;/a&gt; &lt;/div&gt;${textHtml} ${attachmentsHtml} ${dueHtml} &lt;/div&gt; &lt;/div&gt;`; timelineDiv.innerHTML += html; }); updateCountdowns(); } function updateCountdowns() { const containers = document.querySelectorAll('.due-container[id^="due-"]'); containers.forEach(el =&gt; { const postIndex = el.getAttribute('data-post-index'); const post = allPosts[postIndex]; if (!post || post.submissionStatus === 'SUBMITTED') { el.innerHTML = `&lt;span class="due-submitted"&gt;ÊèêÂá∫Ê∏à„Åø&lt;/span&gt;`; return; } const now = new Date(); const diff = post.dueDate - now; const isOver = diff &lt; 0; const absDiff = Math.abs(diff); const isUrgent = isOver || diff &lt; (24 * 60 * 60 * 1000); const colorClass = isUrgent ? 'due-text-warning' : 'due-text-normal'; let timeStr = ""; if (isOver) { const days = Math.floor(absDiff / (24 * 60 * 60 * 1000)); timeStr = days &gt;= 1 ? `ÊúüÈôêÂàá„Çå ${days}Êó•` : `ÊúüÈôêÂàá„Çå ${Math.floor(absDiff / (60 * 1000))}ÂàÜ`; } else {const d = Math.floor(diff / (24 * 60 * 60 * 1000)); const h = Math.floor((diff % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000)); const m = Math.floor((diff % (60 * 60 * 1000)) / (60 * 1000)); const s = Math.floor((diff % (60 * 1000)) / 1000); timeStr = `ÊúüÈôê„Åæ„Åß ${d &gt; 0 ? d + "Êó•" : ""}${h}ÊôÇÈñì${m}ÂàÜ${s}Áßí`; } el.className = `due-container ${colorClass}`; el.innerText = timeStr; }); } function renderAttachments(materials) { if (!materials || materials.length === 0) return ''; let imagesHtml = ''; let filesHtml = ''; materials.forEach(m =&gt; { if (m.driveFile &amp;&amp; m.driveFile.driveFile) { const file = m.driveFile.driveFile; const title = file.title.toLowerCase(); const link = file.alternateLink; const thumbnailUrl = file.thumbnailUrl ? file.thumbnailUrl.replace(/\/s\d+.*$/, '/s400') : ''; if(thumbnailUrl &amp;&amp; (title.endsWith('.jpg') || title.endsWith('.jpeg') || title.endsWith('.png') || title.endsWith('.gif'))) { imagesHtml += `&lt;div class="media-container"&gt;&lt;img src="${thumbnailUrl}" class="tweet-media-img" onclick="window.open('${link}', '_blank');event.stopPropagation();"&gt;&lt;/div&gt;`; } else if (title.endsWith('.pdf')) { filesHtml += `&lt;a href="${link}" target="_blank" class="attachment-link" onclick="event.stopPropagation()"&gt;&lt;span class="attachment-icon"&gt;üìÑ&lt;/span&gt;&lt;span class="attachment-title"&gt;${escapeHtml(file.title)}&lt;/span&gt;&lt;/a&gt;`; } } });return imagesHtml + (filesHtml ? `&lt;div class="attachments-list"&gt;${filesHtml}&lt;/div&gt;` : ''); } functionformatTweetText(post, i) { const text = post.text || ""; const limit = 140; const id = `t-${i}`; if (text.length &lt;= limit) return `&lt;div class="tweet-text"&gt;${linkify(escapeHtml(text))}&lt;/div&gt;`; return `&lt;div class="tweet-text" id="${id}-s"&gt;${linkify(escapeHtml(text.substring(0, limit)))}... &lt;a href="#" class="more-link" onclick="showMore(event, '${id}')"&gt;„Åï„Çâ„Å´Ë°®Á§∫&lt;/a&gt;&lt;/div&gt;&lt;div class="tweet-text" id="${id}-f" style="display:none;"&gt;${linkify(escapeHtml(text))}&lt;/div&gt;`; } window.showMore = (e, id) =&gt; { e.preventDefault(); e.stopPropagation(); document.getElementById(`${id}-s`).style.display = 'none'; document.getElementById(`${id}-f`).style.display = 'block'; }; function formatDate(d) { const diff = (new Date() - d) / 1000; if (diff &lt; 3600) return`${Math.floor(diff / 60)}ÂàÜ`; if (diff &lt; 86400) return `${Math.floor(diff / 3600)}ÊôÇÈñì`; return `${d.getMonth() + 1}Êúà${d.getDate()}Êó•`; } function escapeHtml(s) { return s.replace(/[&amp;&lt;&gt;"']/g, m =&gt; ({ '&amp;': '&amp;amp;', '&lt;': '&amp;lt;', '&gt;': '&amp;gt;', '"': '&amp;quot;', "'": "&amp;#039;" }[m])); } function linkify(s) { return s.replace(/(https?:\/\/[^\s]+)/g, url =&gt; `&lt;a href="${url}" target="_blank" style="color:var(--accent-color);text-decoration:none;" onclick="event.stopPropagation()"&gt;${url}&lt;/a&gt;`); } &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</span></p>
</body>
</html>
